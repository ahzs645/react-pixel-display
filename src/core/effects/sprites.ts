/**
 * Sprite system for PA_SPRITE-style effects.
 *
 * Each sprite is a sequence of frames. A frame is an array of row strings
 * where '#' is a lit pixel and '.' is off.  All frames in a sprite must
 * share the same width and height.
 *
 * The sprite wipes across the display; as it passes each column it
 * reveals (entry) or hides (exit) the underlying text.
 */

export interface SpriteDefinition {
  /** Human-readable name */
  name: string;
  /** Pixel columns per frame */
  width: number;
  /** Pixel rows per frame (typically 8) */
  height: number;
  /** Animation frames – array of row-string arrays */
  frames: string[][];
}

// ---------------------------------------------------------------------------
// Helper – build a SpriteDefinition from compact string data
// ---------------------------------------------------------------------------
function sprite(name: string, frames: string[][]): SpriteDefinition {
  const height = frames[0].length;
  const width = frames[0][0].length;
  return { name, width, height, frames };
}

// ---------------------------------------------------------------------------
// 18 built-in sprites (all 8 rows tall)
// ---------------------------------------------------------------------------

const pacman = sprite('Pacman', [
  // mouth wide
  [
    '..####..',
    '.##.##..',
    '####....',
    '#####...',
    '#####...',
    '####....',
    '.######.',
    '..####..',
  ],
  // mouth half
  [
    '..####..',
    '.######.',
    '##.###..',
    '######..',
    '######..',
    '#######.',
    '.######.',
    '..####..',
  ],
  // mouth closed
  [
    '..####..',
    '.######.',
    '########',
    '########',
    '########',
    '########',
    '.######.',
    '..####..',
  ],
]);

const ghost = sprite('Ghost', [
  [
    '..####..',
    '.######.',
    '.#.##.#.',
    '.######.',
    '########',
    '########',
    '########',
    '#.##.##.',
  ],
  [
    '..####..',
    '.######.',
    '.#.##.#.',
    '.######.',
    '########',
    '########',
    '########',
    '.##.##.#',
  ],
]);

const rocket = sprite('Rocket', [
  [
    '...##...',
    '..####..',
    '..####..',
    '.######.',
    '.######.',
    '########',
    '..#..#..',
    '.#....#.',
  ],
  [
    '...##...',
    '..####..',
    '..####..',
    '.######.',
    '.######.',
    '########',
    '..#..#..',
    '#......#',
  ],
]);

const heart = sprite('Heart', [
  // small beat
  [
    '........',
    '.##.##..',
    '.######.',
    '.######.',
    '..####..',
    '...##...',
    '........',
    '........',
  ],
  // large beat
  [
    '........',
    '.##.##..',
    '########',
    '########',
    '.######.',
    '..####..',
    '...##...',
    '........',
  ],
]);

const arrowRight = sprite('Arrow Right', [
  [
    '....#...',
    '....##..',
    '....###.',
    '########',
    '########',
    '....###.',
    '....##..',
    '....#...',
  ],
  [
    '...#....',
    '...##...',
    '...###..',
    '.#######',
    '.#######',
    '...###..',
    '...##...',
    '...#....',
  ],
]);

const arrowLeft = sprite('Arrow Left', [
  [
    '...#....',
    '..##....',
    '.###....',
    '########',
    '########',
    '.###....',
    '..##....',
    '...#....',
  ],
  [
    '....#...',
    '...##...',
    '..###...',
    '#######.',
    '#######.',
    '..###...',
    '...##...',
    '....#...',
  ],
]);

const wave = sprite('Wave', [
  [
    '........',
    '........',
    '..##....',
    '.#..#...',
    '#....#.#',
    '......#.',
    '........',
    '........',
  ],
  [
    '........',
    '........',
    '...##...',
    '..#..#..',
    '.#....#.',
    '#......#',
    '........',
    '........',
  ],
  [
    '........',
    '........',
    '....##..',
    '...#..#.',
    '#.#....#',
    '.#......',
    '........',
    '........',
  ],
  [
    '........',
    '........',
    '...##...',
    '..#..#..',
    '.#....#.',
    '#......#',
    '........',
    '........',
  ],
]);

const fireSpr = sprite('Fire', [
  [
    '...##...',
    '..####..',
    '..####..',
    '.######.',
    '.######.',
    '.######.',
    '..####..',
    '...##...',
  ],
  [
    '...##...',
    '..###...',
    '.#####..',
    '.######.',
    '.######.',
    '..####..',
    '..####..',
    '...##...',
  ],
  [
    '....#...',
    '...###..',
    '..#####.',
    '.######.',
    '.######.',
    '.#####..',
    '..####..',
    '...##...',
  ],
]);

const ball = sprite('Ball', [
  [
    '..####..',
    '.#.####.',
    '#..#####',
    '#...####',
    '########',
    '########',
    '.######.',
    '..####..',
  ],
  [
    '..####..',
    '.######.',
    '########',
    '########',
    '####...#',
    '#####..#',
    '.####.#.',
    '..####..',
  ],
]);

const invader = sprite('Invader', [
  [
    '..#..#..',
    '...##...',
    '..####..',
    '.##..##.',
    '########',
    '#.####.#',
    '#.#..#.#',
    '..#..#..',
  ],
  [
    '..#..#..',
    '...##...',
    '..####..',
    '.##..##.',
    '########',
    '#.####.#',
    '#......#',
    '.#....#.',
  ],
]);

const scissors = sprite('Scissors', [
  // open
  [
    '.##.....',
    '#..#....',
    '#..#....',
    '.###....',
    '...####.',
    '.###....',
    '#..#....',
    '.##.....',
  ],
  // closed
  [
    '........',
    '.##.....',
    '#..##...',
    '.#######',
    '.#######',
    '#..##...',
    '.##.....',
    '........',
  ],
]);

const caterpillar = sprite('Caterpillar', [
  [
    '........',
    '........',
    '.#......',
    '#.#.##..',
    '..##..#.',
    '......#.',
    '.......#',
    '........',
  ],
  [
    '........',
    '........',
    '.#......',
    '#.##..#.',
    '....##..',
    '..#...#.',
    '.#......',
    '........',
  ],
]);

const walker = sprite('Walker', [
  [
    '...##...',
    '...##...',
    '..####..',
    '..####..',
    '...##...',
    '..#..#..',
    '.#....#.',
    '#......#',
  ],
  [
    '...##...',
    '...##...',
    '..####..',
    '..####..',
    '...##...',
    '..####..',
    '..#..#..',
    '..#..#..',
  ],
]);

const car = sprite('Car', [
  [
    '........',
    '........',
    '..####..',
    '.######.',
    '########',
    '########',
    '.#.##.#.',
    '..#..#..',
  ],
  [
    '........',
    '........',
    '..####..',
    '.######.',
    '########',
    '########',
    '#.#..#.#',
    '.#....#.',
  ],
]);

const chevron = sprite('Chevron', [
  [
    '#...#...',
    '##..##..',
    '.##..##.',
    '..##..##',
    '..##..##',
    '.##..##.',
    '##..##..',
    '#...#...',
  ],
  [
    '...#...#',
    '..##..##',
    '.##..##.',
    '##..##..',
    '##..##..',
    '.##..##.',
    '..##..##',
    '...#...#',
  ],
]);

const lines = sprite('Lines', [
  [
    '########',
    '........',
    '########',
    '........',
    '########',
    '........',
    '########',
    '........',
  ],
  [
    '........',
    '########',
    '........',
    '########',
    '........',
    '########',
    '........',
    '########',
  ],
]);

const sailboat = sprite('Sailboat', [
  [
    '...#....',
    '...##...',
    '...###..',
    '...####.',
    '...#....',
    '.######.',
    '..####..',
    '...##...',
  ],
  [
    '....#...',
    '...##...',
    '..###...',
    '.####...',
    '....#...',
    '.######.',
    '..####..',
    '...##...',
  ],
]);

const musicNote = sprite('Music Note', [
  [
    '...####.',
    '...####.',
    '...#....',
    '...#....',
    '...#....',
    '.###....',
    '####....',
    '.##.....',
  ],
  [
    '........',
    '...####.',
    '...####.',
    '...#....',
    '...#....',
    '.###....',
    '####....',
    '.##.....',
  ],
]);

// ---------------------------------------------------------------------------
// Public registry
// ---------------------------------------------------------------------------

export const SPRITES: Record<string, SpriteDefinition> = {
  pacman,
  ghost,
  rocket,
  heart,
  arrow_right: arrowRight,
  arrow_left: arrowLeft,
  wave,
  fire: fireSpr,
  ball,
  invader,
  scissors,
  caterpillar,
  walker,
  car,
  chevron,
  lines,
  sailboat,
  music_note: musicNote,
};

export const SPRITE_NAMES = Object.keys(SPRITES);

/** Look up a built-in sprite by key, or return the definition as-is if it's already one. */
export function resolveSprite(spriteOrName: string | SpriteDefinition): SpriteDefinition | null {
  if (typeof spriteOrName === 'string') {
    return SPRITES[spriteOrName] ?? null;
  }
  return spriteOrName;
}
